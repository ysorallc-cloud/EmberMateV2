<!DOCTYPE html>
<!-- EmberMate V2.8 - DE-IDENTIFIED DEMO VERSION - Updated: 2025-10-29 
     
     ⚠️ DEMONSTRATION MODE - ALL DATA FICTIONAL & ANONYMIZED ⚠️
     This version contains no Protected Health Information (PHI).
     All names, medical values, medications, and personal data are generic placeholders.
     
     PRODUCTION BASELINE - Profile-aware optimization & QA-ready:
     ✓ Profile-aware data limits (1,000 entries per profile max)
     ✓ Smart archiving with user notifications
     ✓ Test attributes for QA automation (data-test="*")
     ✓ Improved caregiver-focused copy
     ✓ Large text support (125-150% zoom)
     ✓ Accessibility: reduced motion, high contrast, ARIA
     
     DE-IDENTIFICATION APPLIED:
     ✓ Generic user names and avatars
     ✓ Anonymized medical values and ranges
     ✓ Generic medication names (Medication A, B, etc.)
     ✓ Relative timestamps instead of specific times
     ✓ No personal notes or symptom details
     ✓ Demo-clarified HIPAA disclaimer
     ✓ Sample data uses generic placeholders
     
     TEST MATRIX REQUIREMENTS:
     Browsers: iPhone Safari, Android Chrome, desktop Chrome/Edge
     A11y Tests: Reduced motion ON, Large text (125-150%), Dark mode ON, Private window
     Features: Profile switching, data archiving, quick actions, vitals tracking
     
     Caregiver Quick Actions (V2.7):
     - "Meds Done" - Instant medication logging
     - "Ask for vitals" - Send vitals reminder
     - "Note for tomorrow" - Schedule reminder notes
     - Auto-profile tagging on all entries
     
     Health Log UX (V2.6.5):
     - AI Summary at top with daily progress snapshot
     - Status tags on snapshot cards
     - Unified timeline with sticky date headers
     - Context-aware suggested actions
     - Conversational microcopy throughout
     
     Core Features:
     - Profile management with quick switcher
     - Medication tracking with reminders
     - Vitals monitoring (BP, glucose, weight, temp, O2)
     - Appointment scheduling
     - Symptoms & mood tracking
     - Analytics dashboard
     - Gamification (XP, badges, Health Buddy)
     - Zero-PHI local storage
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmberMate - Your Health Companion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Ember Sage Theme - Light Mode Base */
            --bg-primary: #F8F5F3;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #EFEBE9;
            --text-primary: #2D2623;
            --text-secondary: #5E534F;
            --text-tertiary: #8B7E79;
            --border-color: #D7CCC8;
            --shadow: rgba(62, 47, 70, 0.08);
            --shadow-lg: rgba(62, 47, 70, 0.12);
            
            /* Brand Colors - Ember Sage Palette */
            --primary: #CD876E;
            --primary-dark: #B57560;
            --secondary: #EFBE9E;
            --accent: #3E2F46;
            --success: #81A684;
            --success-soft: rgba(129, 166, 132, 0.12);
            --warning: #E6B88A;
            --warning-soft: rgba(230, 184, 138, 0.12);
            --danger: #C97064;
            --danger-soft: rgba(201, 112, 100, 0.12);
            --info: #8BA3B8;
            --info-soft: rgba(139, 163, 184, 0.12);
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Transitions - Standardized */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-standard: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Focus Ring - Standardized */
            --focus-ring: 0 0 0 3px rgba(205, 135, 110, 0.3);
            --focus-ring-offset: 2px;
        }

        /* Base Styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        /* Skip to Main Content Link - Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: var(--radius-md);
            z-index: 10000;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 0.5rem;
            left: 0.5rem;
            outline: none;
            box-shadow: var(--focus-ring);
        }

        /* Typography - Standardized Hierarchy */
        h1 { font-size: 2rem; font-weight: 700; line-height: 1.2; letter-spacing: -0.02em; }
        h2 { font-size: 1.5rem; font-weight: 600; line-height: 1.3; letter-spacing: -0.01em; }
        h3 { font-size: 1.25rem; font-weight: 600; line-height: 1.4; }
        h4 { font-size: 1.125rem; font-weight: 600; line-height: 1.4; }
        h5 { font-size: 1rem; font-weight: 600; line-height: 1.5; }
        h6 { font-size: 0.875rem; font-weight: 600; line-height: 1.5; }

        p { font-size: 1rem; line-height: 1.6; }
        small { font-size: 0.875rem; line-height: 1.5; }
        .text-xs { font-size: 0.75rem; line-height: 1.5; }

        /* Focus Ring Standardization */
        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        [tabindex]:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
            outline-offset: var(--focus-ring-offset);
        }

        button:focus:not(:focus-visible),
        a:focus:not(:focus-visible),
        input:focus:not(:focus-visible),
        select:focus:not(:focus-visible),
        textarea:focus:not(:focus-visible),
        [tabindex]:focus:not(:focus-visible) {
            outline: none;
            box-shadow: none;
        }

        /* Container & Layout */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1.5rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            font-size: 1.75rem;
            filter: drop-shadow(0 2px 4px var(--shadow));
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Profile Switcher */
        .profile-switcher {
            position: relative;
        }

        .profile-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 0.9375rem;
            font-weight: 500;
        }

        .profile-btn:hover {
            background: var(--bg-primary);
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .profile-avatar {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            min-width: 16rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: 0 10px 30px var(--shadow-lg);
            display: none;
            z-index: 200;
            max-height: 24rem;
            overflow-y: auto;
        }

        .profile-dropdown.show {
            display: block;
            animation: slideDown 0.15s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-0.5rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-dropdown-header h4 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .profile-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: var(--transition-fast);
            border-bottom: 1px solid var(--border-color);
        }

        .profile-item:last-child {
            border-bottom: none;
        }

        .profile-item:hover {
            background: var(--bg-tertiary);
        }

        .profile-item.active {
            background: rgba(205, 135, 110, 0.08);
            border-left: 3px solid var(--primary);
        }

        .profile-item-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--info));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .profile-item-info {
            flex: 1;
            min-width: 0;
        }

        .profile-item-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--text-primary);
            margin-bottom: 0.125rem;
        }

        .profile-item-relation {
            font-size: 0.8125rem;
            color: var(--text-tertiary);
        }

        .profile-item-badge {
            padding: 0.25rem 0.5rem;
            background: var(--success);
            color: white;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .add-profile-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--primary);
            font-weight: 600;
            border-top: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .add-profile-btn:hover {
            background: var(--bg-tertiary);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.25rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            padding: 0 1.5rem;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            padding: 0.875rem 1.25rem;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition-fast);
            white-space: nowrap;
            font-size: 0.9375rem;
            position: relative;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.03);
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .nav-tab-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            padding: 0.125rem 0.375rem;
            border-radius: var(--radius-full);
            font-weight: 700;
            min-width: 1.125rem;
            text-align: center;
        }

        /* Main Content Area */
        .main-content {
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.15s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(0.5rem); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition-fast);
        }

        .card:hover {
            border-color: rgba(205, 135, 110, 0.3);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Buttons - Standardized */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            border: none;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            line-height: 1.5;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(205, 135, 110, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-primary);
            border-color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #5ab86e;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #e6005f;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 0.875rem 1.75rem;
            font-size: 1rem;
        }

        /* Form Elements - Standardized */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9375rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 0.9375rem;
            font-family: inherit;
            transition: var(--transition-fast);
        }

        .form-input:hover,
        .form-select:hover,
        .form-textarea:hover {
            border-color: rgba(205, 135, 110, 0.5);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-tertiary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 6rem;
        }

        /* Modal - Standardized */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.15s ease;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            max-width: 600px;
            width: 100%;
            max-height: calc(100vh - 2rem);
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow-lg);
            animation: slideUp 0.2s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(2rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            font-size: 1.5rem;
            line-height: 1;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* Onboarding Modal */
        #onboardingModal {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #onboardingModal .modal-content {
            animation: slideUp 0.3s ease;
        }

        .onboarding-step .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 0 10px 30px var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            pointer-events: auto;
            animation: slideInRight 0.2s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(2rem);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.removing {
            animation: slideOutRight 0.2s ease forwards;
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(2rem);
            }
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--danger);
        }

        .toast-warning {
            border-left: 4px solid var(--warning);
        }

        .toast-info {
            border-left: 4px solid var(--info);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                var(--bg-tertiary) 25%,
                var(--bg-secondary) 50%,
                var(--bg-tertiary) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state-message {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.375rem; }
            h3 { font-size: 1.125rem; }
            
            .header-content {
                padding: 1rem;
                gap: 1rem;
            }

            .logo-text {
                font-size: 1.25rem;
            }

            .profile-btn {
                padding: 0.5rem 0.75rem;
            }

            .profile-btn-text {
                display: none;
            }

            .nav-tabs {
                padding: 0 1rem;
            }

            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            .main-content {
                padding: 0.75rem;
            }

            .card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .ai-summary-section,
            .caregiver-quick-actions,
            .timeline-section,
            .suggested-actions {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .snapshot-grid {
                gap: 0.75rem;
                margin-bottom: 1rem;
            }

            .snapshot-card {
                padding: 1rem;
            }

            .timeline-header {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .timeline-entry {
                padding: 0.75rem 0.75rem 0.75rem 1rem;
                margin-bottom: 0.5rem;
            }

            .modal-content {
                margin: 0;
                border-radius: var(--radius-lg);
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 1rem;
            }

            .btn {
                width: 100%;
            }

            .modal-footer {
                flex-direction: column-reverse;
            }

            .modal-footer .btn {
                width: 100%;
            }

            .glance-strip {
                gap: 0.5rem;
            }

            .action-chips {
                gap: 0.5rem;
            }

            .quick-actions-grid {
                gap: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .toast {
                min-width: auto;
                max-width: calc(100vw - 2rem);
            }

            .toast-container {
                left: 1rem;
                right: 1rem;
            }
        }

        /* Print Styles */
        @media print {
            .header,
            .nav-tabs,
            .btn,
            .modal,
            .toast-container {
                display: none !important;
            }

            body {
                background: white;
                color: black;
            }

            .card {
                border: 1px solid #ccc;
                break-inside: avoid;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #666;
                --text-secondary: #ccc;
            }

            .btn-primary {
                border: 2px solid var(--primary);
            }

            .form-input,
            .form-select,
            .form-textarea {
                border-width: 2px;
            }
        }

        /* Dark Mode (Already default, but explicitly defined) */
        @media (prefers-color-scheme: dark) {
            /* Colors already optimized for dark mode */
        }

        /* Large Text Support (125-150% zoom) */
        @media (min-resolution: 1.25dppx) and (max-resolution: 1.5dppx) {
            body {
                /* Browser handles text scaling, just ensure containers adapt */
                overflow-wrap: break-word;
                word-wrap: break-word;
            }

            .card,
            .modal-content,
            .ai-summary-section {
                max-width: 100%;
            }

            .btn {
                white-space: normal;
                min-height: 2.75rem;
            }

            .nav-tab {
                min-height: 3rem;
            }
        }

        /* ===== TAB-SPECIFIC STYLES ===== */

        /* Health Log Tab */
        .ai-summary-section {
            background: linear-gradient(135deg, rgba(205, 135, 110, 0.08), rgba(239, 190, 158, 0.08));
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .ai-summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .ai-summary-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .ai-summary-content {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .glance-strip {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .glance-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        .glance-icon {
            font-size: 1.25rem;
        }

        .glance-label {
            color: var(--text-tertiary);
            margin-right: 0.25rem;
        }

        .glance-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .action-chips {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .action-chip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .action-chip:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(205, 135, 110, 0.3);
        }

        .snapshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .snapshot-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            transition: var(--transition-fast);
            cursor: pointer;
        }

        .snapshot-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .snapshot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .snapshot-icon {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(205, 135, 110, 0.1);
        }

        .snapshot-status {
            padding: 0.25rem 0.625rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-complete {
            background: var(--success-soft);
            color: var(--success);
        }

        .status-incomplete {
            background: var(--warning-soft);
            color: var(--warning);
        }

        .status-missing {
            background: var(--danger-soft);
            color: var(--danger);
        }

        .snapshot-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .snapshot-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .snapshot-subtitle {
            font-size: 0.8125rem;
            color: var(--text-tertiary);
        }

        .timeline-section {
            margin-bottom: 1.5rem;
        }

        .timeline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
        }

        .timeline-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .timeline-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--success-soft);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            color: var(--success);
        }

        .timeline-filter {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .filter-chip:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .filter-chip.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .timeline-date-group {
            margin-bottom: 2rem;
        }

        .timeline-date-header {
            position: sticky;
            top: 5rem;
            background: var(--bg-primary);
            padding: 0.75rem 0;
            margin-bottom: 1rem;
            z-index: 10;
            border-bottom: 1px solid var(--border-color);
        }

        .timeline-date-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .timeline-entry {
            position: relative;
            padding: 1rem 1rem 1rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            transition: var(--transition-fast);
            cursor: pointer;
        }

        .timeline-entry:hover {
            border-color: var(--primary);
            transform: translateX(4px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .timeline-entry.vitals { border-left-color: var(--info); }
        .timeline-entry.medication { border-left-color: var(--success); }
        .timeline-entry.symptom { border-left-color: var(--warning); }
        .timeline-entry.appointment { border-left-color: var(--secondary); }
        .timeline-entry.note { border-left-color: var(--text-tertiary); }

        .timeline-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .timeline-entry-type {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .timeline-entry-time {
            font-size: 0.8125rem;
            color: var(--text-tertiary);
        }

        .timeline-entry-content {
            font-size: 0.9375rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .timeline-entry-note {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .suggested-actions {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .suggested-actions-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .suggested-actions-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .suggested-actions-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .suggested-action-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
        }

        .suggested-action-item:hover {
            border-color: var(--primary);
            background: var(--bg-primary);
        }

        .suggested-action-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .suggested-action-icon {
            font-size: 1.5rem;
        }

        .suggested-action-text {
            flex: 1;
        }

        .suggested-action-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .suggested-action-subtitle {
            font-size: 0.8125rem;
            color: var(--text-tertiary);
        }

        .suggested-action-btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .suggested-action-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Caregiver Quick Actions (V2.7) */
        .caregiver-quick-actions {
            background: linear-gradient(135deg, rgba(239, 190, 158, 0.08), rgba(205, 135, 110, 0.08));
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .quick-actions-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .quick-actions-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .quick-actions-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .quick-action-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            cursor: pointer;
            transition: var(--transition-fast);
            text-align: center;
        }

        .quick-action-card:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(205, 135, 110, 0.25);
        }

        .quick-action-card:hover .quick-action-icon,
        .quick-action-card:hover .quick-action-title,
        .quick-action-card:hover .quick-action-description {
            color: white;
        }

        .quick-action-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            transition: var(--transition-fast);
        }

        .quick-action-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            transition: var(--transition-fast);
        }

        .quick-action-description {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }

        /* Medications Tab */
        .med-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .med-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            transition: var(--transition-fast);
        }

        .med-card:hover {
            border-color: var(--success);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .med-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .med-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .med-dosage {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .med-status {
            padding: 0.25rem 0.625rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .med-status.active {
            background: var(--success-soft);
            color: var(--success);
        }

        .med-status.paused {
            background: var(--warning-soft);
            color: var(--warning);
        }

        .med-schedule {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .med-time-chip {
            padding: 0.375rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 0.8125rem;
            color: var(--text-primary);
        }

        .med-time-chip.taken {
            background: var(--success-soft);
            border-color: var(--success);
            color: var(--success);
        }

        .med-actions {
            display: flex;
            gap: 0.5rem;
        }

        .med-action-btn {
            flex: 1;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .med-action-btn:hover {
            background: var(--success);
            border-color: var(--success);
            color: white;
            transform: translateY(-2px);
        }

        /* Analytics Tab */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: var(--transition-fast);
        }

        .stat-card:hover {
            border-color: rgba(205, 135, 110, 0.5);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(205, 135, 110, 0.1);
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-trend.positive {
            color: var(--success);
        }

        .stat-trend.negative {
            color: var(--danger);
        }

        .chart-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-control-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .chart-control-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .chart-control-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Gamification */
        .xp-bar-container {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .xp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .xp-level {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .xp-level-badge {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .xp-level-text {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .xp-title {
            font-size: 0.875rem;
            color: var(--secondary);
            font-weight: 600;
        }

        .xp-progress-bar {
            height: 2rem;
            background: var(--bg-primary);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .xp-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: white;
        }

        .xp-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .achievement-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1rem;
            text-align: center;
            transition: var(--transition-fast);
        }

        .achievement-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px var(--shadow);
        }

        .achievement-card.unlocked {
            border-color: var(--secondary);
            background: rgba(239, 190, 158, 0.1);
        }

        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
        }

        .achievement-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .achievement-description {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .health-buddy-card {
            background: linear-gradient(135deg, rgba(205, 135, 110, 0.08), rgba(239, 190, 158, 0.08));
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .health-buddy-avatar {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .health-buddy-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .health-buddy-message {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            font-style: italic;
            max-width: 400px;
            margin: 0 auto 1rem;
        }

        .health-buddy-mood-selector {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .health-buddy-mood-btn {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .health-buddy-mood-btn:hover {
            transform: scale(1.15);
            border-color: var(--primary);
        }

        .health-buddy-mood-btn.active {
            border-color: var(--secondary);
            background: rgba(239, 190, 158, 0.15);
        }

        /* HIPAA Disclaimer */
        .hipaa-disclaimer {
            background: var(--warning-soft);
            border: 1px solid rgba(230, 184, 138, 0.3);
            border-radius: var(--radius-md);
            padding: 0.875rem 1.25rem;
            margin: 1.5rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .hipaa-icon {
            font-size: 1.25rem;
            color: var(--warning);
            flex-shrink: 0;
        }

        .hipaa-content {
            flex: 1;
        }

        .hipaa-title {
            font-weight: 600;
            color: var(--warning);
            font-size: 0.9375rem;
            margin-bottom: 0.25rem;
        }

        .hipaa-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }

        .hidden { display: none; }
        .block { display: block; }
        .inline-block { display: inline-block; }

        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <!-- Skip to Main Content Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" role="alert" aria-live="polite" aria-atomic="true"></div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo" role="img" aria-label="EmberMate Logo">🔥</div>
                    <div class="logo-text">EmberMate</div>
                </div>

                <!-- Profile Switcher -->
                <div class="profile-switcher">
                    <button class="profile-btn" id="profileBtn" 
                            aria-label="Switch profile"
                            aria-haspopup="true"
                            aria-expanded="false">
                        <div class="profile-avatar" id="currentProfileAvatar">👤</div>
                        <span class="profile-btn-text" id="currentProfileName">Demo User</span>
                        <span>▼</span>
                    </button>

                    <div class="profile-dropdown" id="profileDropdown" role="menu">
                        <div class="profile-dropdown-header">
                            <h4>Switch Profile</h4>
                        </div>
                        <div id="profileList" role="group">
                            <!-- Profiles populated by JS -->
                        </div>
                        <div class="add-profile-btn" id="addProfileBtn" role="menuitem" tabindex="0">
                            <span>➕</span>
                            <span>Add New Profile</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs" role="tablist" aria-label="Main navigation">
            <div class="nav-tab active" data-tab="healthLog" data-test="nav-health-log" role="tab" aria-selected="true" aria-controls="healthLog-panel" tabindex="0">
                📋 Health Log
            </div>
            <div class="nav-tab" data-tab="medications" data-test="nav-medications" role="tab" aria-selected="false" aria-controls="medications-panel" tabindex="-1">
                💊 Medications
                <span class="nav-tab-badge" id="medBadge">2</span>
            </div>
            <div class="nav-tab" data-tab="appointments" data-test="nav-appointments" role="tab" aria-selected="false" aria-controls="appointments-panel" tabindex="-1">
                📅 Appointments
            </div>
            <div class="nav-tab" data-tab="analytics" data-test="nav-analytics" role="tab" aria-selected="false" aria-controls="analytics-panel" tabindex="-1">
                📊 Analytics
            </div>
            <div class="nav-tab" data-tab="profile" data-test="nav-profile" role="tab" aria-selected="false" aria-controls="profile-panel" tabindex="-1">
                👤 Profile
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <!-- Health Log Tab -->
            <div class="tab-content active" id="healthLog-panel" role="tabpanel" aria-labelledby="healthLog">
                <!-- AI Summary Section -->
                <section class="ai-summary-section" aria-label="Daily summary">
                    <div class="ai-summary-header">
                        <div class="ai-summary-title">
                            <span>✨</span>
                            <span>Your Day at a Glance</span>
                        </div>
                    </div>

                    <p class="ai-summary-content">
                        You're doing great today! Medications tracked consistently, and vitals are within target range. 
                        Keep logging your health data regularly. You're doing excellent work! 🌟
                    </p>

                    <div class="glance-strip">
                        <div class="glance-item">
                            <span class="glance-icon">💊</span>
                            <span class="glance-label">Meds:</span>
                            <span class="glance-value">Most logged</span>
                        </div>
                        <div class="glance-item">
                            <span class="glance-icon">🩺</span>
                            <span class="glance-label">BP:</span>
                            <span class="glance-value">On target</span>
                        </div>
                        <div class="glance-item">
                            <span class="glance-icon">🎯</span>
                            <span class="glance-label">Week:</span>
                            <span class="glance-value">Active</span>
                        </div>
                    </div>

                    <div class="action-chips">
                        <button class="action-chip" onclick="showQuickAddModal('vitals')" 
                                aria-label="Add vital reading">
                            <span>🩺</span>
                            <span>Add Reading</span>
                        </button>
                        <button class="action-chip" onclick="switchTab('analytics')"
                                aria-label="View health trends">
                            <span>📊</span>
                            <span>View Trends</span>
                        </button>
                        <button class="action-chip" onclick="showQuickAddModal('mood')"
                                aria-label="Log mood">
                            <span>😊</span>
                            <span>Log Mood</span>
                        </button>
                    </div>
                </section>

                <!-- Caregiver Quick Actions (V2.7) -->
                <section class="caregiver-quick-actions" aria-label="Caregiver quick actions">
                    <div class="quick-actions-header">
                        <span>🏥</span>
                        <h2 class="quick-actions-title">Caregiver Quick Actions</h2>
                    </div>
                    <p class="quick-actions-subtitle">
                        Everyday caregiving made simple — 2-3 taps instead of multiple forms
                    </p>

                    <div class="quick-actions-grid">
                        <div class="quick-action-card" onclick="logAllMedsDone()" 
                             role="button" tabindex="0"
                             aria-label="Log all medications as taken"
                             data-test="quick-action-log-meds">
                            <div class="quick-action-icon">💊</div>
                            <div class="quick-action-title">Meds Done</div>
                            <p class="quick-action-description">Quick log: all meds taken today</p>
                        </div>

                        <div class="quick-action-card" onclick="showAskForVitalsModal()"
                             role="button" tabindex="0"
                             aria-label="Send vitals reminder"
                             data-test="quick-action-ask-vitals">
                            <div class="quick-action-icon">📲</div>
                            <div class="quick-action-title">Ask for Vitals</div>
                            <p class="quick-action-description">Gentle reminder to check readings</p>
                        </div>

                        <div class="quick-action-card" onclick="showAddNoteForTomorrowModal()"
                             role="button" tabindex="0"
                             aria-label="Add reminder note"
                             data-test="quick-action-note-tomorrow">
                            <div class="quick-action-icon">📝</div>
                            <div class="quick-action-title">Note for Tomorrow</div>
                            <p class="quick-action-description">Set a reminder for later</p>
                        </div>
                    </div>
                </section>

                <!-- Snapshot Cards -->
                <section aria-label="Health snapshot">
                    <div class="snapshot-grid">
                        <div class="snapshot-card" onclick="showQuickAddModal('vitals')">
                            <div class="snapshot-header">
                                <div class="snapshot-icon">🩺</div>
                                <span class="snapshot-status status-complete">Up to date</span>
                            </div>
                            <div class="snapshot-title">Blood Pressure</div>
                            <div class="snapshot-value">Within target</div>
                            <div class="snapshot-subtitle">Looking good</div>
                        </div>

                        <div class="snapshot-card" onclick="showQuickAddModal('glucose')">
                            <div class="snapshot-header">
                                <div class="snapshot-icon">🩸</div>
                                <span class="snapshot-status status-complete">Normal range</span>
                            </div>
                            <div class="snapshot-title">Blood Sugar</div>
                            <div class="snapshot-value">Normal range</div>
                            <div class="snapshot-subtitle">Recently checked</div>
                        </div>

                        <div class="snapshot-card" onclick="showQuickAddModal('medication')">
                            <div class="snapshot-header">
                                <div class="snapshot-icon">💊</div>
                                <span class="snapshot-status status-incomplete">1 remaining</span>
                            </div>
                            <div class="snapshot-title">Medications</div>
                            <div class="snapshot-value">Most taken</div>
                            <div class="snapshot-subtitle">Next dose later today</div>
                        </div>

                        <div class="snapshot-card" onclick="showQuickAddModal('weight')">
                            <div class="snapshot-header">
                                <div class="snapshot-icon">⚖️</div>
                                <span class="snapshot-status status-missing">Check today</span>
                            </div>
                            <div class="snapshot-title">Weight</div>
                            <div class="snapshot-value">--</div>
                            <div class="snapshot-subtitle">Check when ready</div>
                        </div>
                    </div>
                </section>

                <!-- Unified Timeline -->
                <section class="timeline-section" aria-label="Health timeline">
                    <div class="timeline-header">
                        <h2 class="timeline-title">Your Health Story</h2>
                        <div class="timeline-progress">
                            <span>✅</span>
                            <span>You're on track! Regular updates this week</span>
                        </div>
                    </div>

                    <!-- Filter Bar -->
                    <div class="timeline-filter" role="group" aria-label="Filter timeline">
                        <button class="filter-chip active" data-filter="all">All</button>
                        <button class="filter-chip" data-filter="vitals">🩺 Vitals</button>
                        <button class="filter-chip" data-filter="medication">💊 Meds</button>
                        <button class="filter-chip" data-filter="symptoms">🤒 Symptoms</button>
                        <button class="filter-chip" data-filter="appointments">📅 Appointments</button>
                    </div>

                    <!-- Timeline Entries -->
                    <div id="timelineContainer">
                        <!-- Today -->
                        <div class="timeline-date-group">
                            <div class="timeline-date-header">
                                <h3>Today</h3>
                            </div>

                            <article class="timeline-entry vitals">
                                <div class="timeline-entry-header">
                                    <span class="timeline-entry-type">Vitals</span>
                                    <span class="timeline-entry-time">Earlier today</span>
                                </div>
                                <div class="timeline-entry-content">
                                    Blood pressure recorded and within target range
                                </div>
                            </article>

                            <article class="timeline-entry medication">
                                <div class="timeline-entry-header">
                                    <span class="timeline-entry-type">Medication</span>
                                    <span class="timeline-entry-time">Morning</span>
                                </div>
                                <div class="timeline-entry-content">
                                    Medication A logged as taken
                                </div>
                            </article>

                            <article class="timeline-entry vitals">
                                <div class="timeline-entry-header">
                                    <span class="timeline-entry-type">Vitals</span>
                                    <span class="timeline-entry-time">Morning</span>
                                </div>
                                <div class="timeline-entry-content">
                                    Blood sugar checked — within normal range
                                </div>
                            </article>
                        </div>

                        <!-- Yesterday -->
                        <div class="timeline-date-group">
                            <div class="timeline-date-header">
                                <h3>Yesterday</h3>
                            </div>

                            <article class="timeline-entry medication">
                                <div class="timeline-entry-header">
                                    <span class="timeline-entry-type">Medication</span>
                                    <span class="timeline-entry-time">Evening</span>
                                </div>
                                <div class="timeline-entry-content">
                                    Medication B logged as taken
                                </div>
                            </article>

                            <article class="timeline-entry symptom">
                                <div class="timeline-entry-header">
                                    <span class="timeline-entry-type">Symptom</span>
                                    <span class="timeline-entry-time">Afternoon</span>
                                </div>
                                <div class="timeline-entry-content">
                                    Symptom noted and tracked
                                </div>
                            </article>
                        </div>

                        <!-- Empty State (shown when no entries) -->
                        <div class="empty-state hidden" id="timelineEmptyState">
                            <div class="empty-state-icon">📝</div>
                            <div class="empty-state-title">No entries yet</div>
                            <p class="empty-state-message">
                                Start tracking your health journey by adding your first entry above
                            </p>
                            <button class="btn btn-primary" onclick="showQuickAddModal('vitals')">
                                Log your first health update
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Suggested Next Steps -->
                <section class="suggested-actions" aria-label="Suggested actions">
                    <div class="suggested-actions-header">
                        <span>💡</span>
                        <h2 class="suggested-actions-title">Suggested Next Steps</h2>
                    </div>

                    <div class="suggested-actions-list">
                        <div class="suggested-action-item">
                            <div class="suggested-action-content">
                                <span class="suggested-action-icon">💊</span>
                                <div class="suggested-action-text">
                                    <div class="suggested-action-title">Next Medication</div>
                                    <div class="suggested-action-subtitle">Next dose due soon</div>
                                </div>
                            </div>
                            <button class="suggested-action-btn" onclick="logMedication('medication')">
                                Log Now
                            </button>
                        </div>

                        <div class="suggested-action-item">
                            <div class="suggested-action-content">
                                <span class="suggested-action-icon">⚖️</span>
                                <div class="suggested-action-text">
                                    <div class="suggested-action-title">Check Your Weight</div>
                                    <div class="suggested-action-subtitle">Ready for next check-in</div>
                                </div>
                            </div>
                            <button class="suggested-action-btn" onclick="showQuickAddModal('weight')">
                                Add Weight
                            </button>
                        </div>

                        <div class="suggested-action-item">
                            <div class="suggested-action-content">
                                <span class="suggested-action-icon">😊</span>
                                <div class="suggested-action-text">
                                    <div class="suggested-action-title">How Are You Feeling?</div>
                                    <div class="suggested-action-subtitle">Quick mood check-in</div>
                                </div>
                            </div>
                            <button class="suggested-action-btn" onclick="showQuickAddModal('mood')">
                                Log Mood
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Medications Tab -->
            <div class="tab-content" id="medications-panel" role="tabpanel" aria-labelledby="medications">
                <div class="card-header">
                    <h2 class="card-title">Your Medications</h2>
                    <button class="btn btn-primary" onclick="showAddMedicationModal()">
                        ➕ Add Medication
                    </button>
                </div>

                <div class="med-grid" id="medicationsContainer">
                    <!-- Medications populated by JS -->
                    <div class="empty-state">
                        <div class="empty-state-icon">💊</div>
                        <div class="empty-state-title">No medications yet</div>
                        <p class="empty-state-message">
                            Add your first medication to start tracking
                        </p>
                        <button class="btn btn-primary" onclick="showAddMedicationModal()">
                            Add First Medication
                        </button>
                    </div>
                </div>
            </div>

            <!-- Appointments Tab -->
            <div class="tab-content" id="appointments-panel" role="tabpanel" aria-labelledby="appointments">
                <div class="card-header">
                    <h2 class="card-title">Upcoming Appointments</h2>
                    <button class="btn btn-primary" onclick="showAddAppointmentModal()">
                        ➕ Schedule Appointment
                    </button>
                </div>

                <div id="appointmentsContainer">
                    <!-- Appointments populated by JS -->
                    <div class="empty-state">
                        <div class="empty-state-icon">📅</div>
                        <div class="empty-state-title">No appointments scheduled</div>
                        <p class="empty-state-message">
                            Schedule your first appointment to stay on track
                        </p>
                        <button class="btn btn-primary" onclick="showAddAppointmentModal()">
                            Schedule First Appointment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" id="analytics-panel" role="tabpanel" aria-labelledby="analytics">
                <div class="card-header">
                    <h2 class="card-title">Health Analytics</h2>
                    <div class="chart-controls">
                        <button class="chart-control-btn active" data-period="7d">7 Days</button>
                        <button class="chart-control-btn" data-period="30d">30 Days</button>
                        <button class="chart-control-btn" data-period="90d">90 Days</button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="analytics-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">💊</div>
                            <div class="stat-info">
                                <div class="stat-label">Medication Adherence</div>
                                <div class="stat-value">Excellent</div>
                            </div>
                        </div>
                        <div class="stat-trend positive">
                            <span>✓</span>
                            <span>Consistent tracking</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">🩺</div>
                            <div class="stat-info">
                                <div class="stat-label">Avg Blood Pressure</div>
                                <div class="stat-value">On target</div>
                            </div>
                        </div>
                        <div class="stat-trend positive">
                            <span>✓</span>
                            <span>Within target range</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">📊</div>
                            <div class="stat-info">
                                <div class="stat-label">Health Entries</div>
                                <div class="stat-value">Active</div>
                            </div>
                        </div>
                        <div class="stat-trend positive">
                            <span>✓</span>
                            <span>Regular logging</span>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Blood Pressure Trend</h3>
                    </div>
                    <canvas id="bpChart" aria-label="Blood pressure trend chart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Blood Sugar Trend</h3>
                    </div>
                    <canvas id="bsChart" aria-label="Blood sugar trend chart"></canvas>
                </div>

                <!-- Gamification Section -->
                <div class="xp-bar-container">
                    <div class="xp-header">
                        <div class="xp-level">
                            <div class="xp-level-badge" aria-label="Level 12">12</div>
                            <span class="xp-level-text">Guardian Level 12</span>
                        </div>
                        <span class="xp-title">Demo Progress</span>
                    </div>

                    <div class="xp-progress-bar" role="progressbar" 
                         aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"
                         aria-label="Experience progress: 65 percent">
                        <div class="xp-progress-fill" style="width: 65%">
                            Demo XP Display
                        </div>
                    </div>

                    <div class="xp-info">
                        <span>Keep tracking regularly!</span>
                        <span>🎯 Stay engaged</span>
                    </div>
                </div>

                <div class="health-buddy-card">
                    <div class="health-buddy-avatar">🐻</div>
                    <div class="health-buddy-name">Buddy the Health Bear</div>
                    <p class="health-buddy-message">
                        "Welcome! Regular tracking helps you stay on top of your health. 
                        How are you feeling today?"
                    </p>
                    <div class="health-buddy-mood-selector" role="group" aria-label="Select your mood">
                        <button class="health-buddy-mood-btn" onclick="logMood('great')" 
                                aria-label="Feeling great">😄</button>
                        <button class="health-buddy-mood-btn" onclick="logMood('good')"
                                aria-label="Feeling good">😊</button>
                        <button class="health-buddy-mood-btn" onclick="logMood('okay')"
                                aria-label="Feeling okay">😐</button>
                        <button class="health-buddy-mood-btn" onclick="logMood('tired')"
                                aria-label="Feeling tired">😴</button>
                        <button class="health-buddy-mood-btn" onclick="logMood('unwell')"
                                aria-label="Not feeling well">😷</button>
                    </div>
                </div>

                <h3 style="margin: 2rem 0 1rem;">Your Achievements</h3>
                <div class="achievement-grid">
                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">🏆</div>
                        <div class="achievement-name">First Steps</div>
                        <p class="achievement-description">Created your first health entry</p>
                    </div>

                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">🔥</div>
                        <div class="achievement-name">7-Day Streak</div>
                        <p class="achievement-description">Logged health data regularly</p>
                    </div>

                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">💊</div>
                        <div class="achievement-name">Med Master</div>
                        <p class="achievement-description">Consistent medication tracking</p>
                    </div>

                    <div class="achievement-card locked">
                        <div class="achievement-icon">⭐</div>
                        <div class="achievement-name">30-Day Champion</div>
                        <p class="achievement-description">Maintain a 30-day logging streak</p>
                    </div>

                    <div class="achievement-card locked">
                        <div class="achievement-icon">🎯</div>
                        <div class="achievement-name">Target Achieved</div>
                        <p class="achievement-description">Consistent health tracking</p>
                    </div>

                    <div class="achievement-card locked">
                        <div class="achievement-icon">👨‍⚕️</div>
                        <div class="achievement-name">Health Advocate</div>
                        <p class="achievement-description">Attend medical appointments</p>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-content" id="profile-panel" role="tabpanel" aria-labelledby="profile">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Profile Settings</h2>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="profileNameInput">Name</label>
                        <input type="text" id="profileNameInput" class="form-input" 
                               placeholder="Enter name" value="Demo User">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="profileRelationInput">Relation</label>
                        <select id="profileRelationInput" class="form-select">
                            <option value="self">Self</option>
                            <option value="parent">Parent</option>
                            <option value="child">Child</option>
                            <option value="spouse">Spouse</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="profileDOBInput">Date of Birth</label>
                        <input type="date" id="profileDOBInput" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="profileConditionsInput">Health Conditions</label>
                        <textarea id="profileConditionsInput" class="form-textarea" 
                                  placeholder="List any chronic conditions or health concerns"></textarea>
                    </div>

                    <button class="btn btn-primary" onclick="saveProfileSettings()">
                        Save Changes
                    </button>
                </div>

                <!-- HIPAA Disclaimer -->
                <div class="hipaa-disclaimer" role="note" aria-label="Privacy information">
                    <div class="hipaa-icon" aria-hidden="true">ℹ️</div>
                    <div class="hipaa-content">
                        <div class="hipaa-title">Demo Mode - Fictional Data Only</div>
                        <p class="hipaa-text">
                            This demonstration does not store or process Protected Health Information (PHI). 
                            All data shown are fictional examples and fully anonymized for demonstration purposes. 
                            EmberMate stores everything locally in your browser when used with real data. 
                            Always share important health updates with your doctor.
                        </p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Data Management</h2>
                    </div>

                    <div id="archivedEntriesNotice" style="display: none; padding: 1rem; background: var(--info-soft, rgba(139, 163, 184, 0.12)); border-radius: var(--radius-md); margin-bottom: 1rem; color: var(--text-secondary);">
                        <strong>📦 Archive:</strong> <span id="archivedCount">0</span> older entries archived to keep the app fast.
                    </div>

                    <button class="btn btn-secondary mb-2" onclick="exportData()" data-test="btn-export-data">
                        📥 Share with family
                    </button>

                    <button class="btn btn-secondary mb-2" onclick="importData()" data-test="btn-import-data">
                        📤 Import Backup
                    </button>

                    <button class="btn btn-secondary mb-2" onclick="importCSV()" data-test="btn-import-csv">
                        📋 Import from CSV
                    </button>

                    <button class="btn btn-danger" onclick="clearAllData()" data-test="btn-clear-data">
                        🗑️ Clear All Data
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Quick Add Modal -->
    <div class="modal" id="quickAddModal" role="dialog" aria-labelledby="quickAddModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="quickAddModalTitle">Add Health Entry</h3>
                <button class="modal-close" onclick="closeModal('quickAddModal')" aria-label="Close modal">×</button>
            </div>
            <div class="modal-body" id="quickAddModalBody">
                <!-- Content populated by JS -->
            </div>
        </div>
    </div>

    <!-- Add Profile Modal -->
    <div class="modal" id="addProfileModal" role="dialog" aria-labelledby="addProfileModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="addProfileModalTitle">Add New Profile</h3>
                <button class="modal-close" onclick="closeModal('addProfileModal')" aria-label="Close modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="newProfileName">Name</label>
                    <input type="text" id="newProfileName" class="form-input" 
                           placeholder="Enter name" autofocus>
                </div>

                <div class="form-group">
                    <label class="form-label" for="newProfileRelation">Relation</label>
                    <select id="newProfileRelation" class="form-select">
                        <option value="self">Self</option>
                        <option value="parent">Parent</option>
                        <option value="child">Child</option>
                        <option value="spouse">Spouse</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="sibling">Sibling</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addProfileModal')">
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="createNewProfile()">
                    Create Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div class="modal" id="onboardingModal" role="dialog" aria-labelledby="onboardingModalTitle" aria-modal="true" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <!-- Step 1: Role Selection -->
            <div id="onboardingStep1" class="onboarding-step">
                <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                    <h3 class="modal-title" id="onboardingModalTitle" style="text-align: center; width: 100%; font-size: 1.75rem;">Welcome to EmberMate 👋</h3>
                </div>
                <div class="modal-body" style="padding-top: 1rem;">
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem; font-size: 1.125rem;">
                        Let's get you started in just a few steps
                    </p>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button class="btn" onclick="selectRole('patient')" style="padding: 1.5rem; font-size: 1.125rem; text-align: left; display: flex; align-items: center; gap: 1rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); transition: all 0.2s;">
                            <span style="font-size: 2rem;">🏥</span>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">I'm managing my own health</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Track your personal health journey</div>
                            </div>
                        </button>
                        <button class="btn" onclick="selectRole('caregiver')" style="padding: 1.5rem; font-size: 1.125rem; text-align: left; display: flex; align-items: center; gap: 1rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); transition: all 0.2s;">
                            <span style="font-size: 2rem;">❤️</span>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">I care for someone</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Track health for family or friends</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Create Profile -->
            <div id="onboardingStep2" class="onboarding-step" style="display: none;">
                <div class="modal-header">
                    <h3 class="modal-title" style="text-align: center; width: 100%;">Create your first profile</h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="onboardingName">Name</label>
                        <input type="text" id="onboardingName" class="form-input" placeholder="Enter name" autofocus>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="onboardingRelation">Relation</label>
                        <select id="onboardingRelation" class="form-select">
                            <option value="self">Self</option>
                            <option value="parent">Parent</option>
                            <option value="child">Child</option>
                            <option value="spouse">Spouse</option>
                            <option value="grandparent">Grandparent</option>
                            <option value="sibling">Sibling</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="onboardingBack(1)">Back</button>
                    <button class="btn btn-primary" onclick="onboardingCreateProfile()">Continue</button>
                </div>
            </div>

            <!-- Step 3: Sample Entries -->
            <div id="onboardingStep3" class="onboarding-step" style="display: none;">
                <div class="modal-header">
                    <h3 class="modal-title" style="text-align: center; width: 100%;">Here's what you can track</h3>
                </div>
                <div class="modal-body">
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1.5rem;">
                        EmberMate helps you log health updates easily
                    </p>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 1.5rem;">💊</span>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Medications</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Quick "Mark as done" for daily meds</div>
                            </div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 1.5rem;">❤️</span>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Vitals</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Blood pressure, glucose, weight, and more</div>
                            </div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md); display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 1.5rem;">😊</span>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Mood & Symptoms</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">Track how you're feeling each day</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="finishOnboarding()" style="width: 100%;">Your app is ready!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL STATE =====
        const APP_CONFIG = {
            MAX_ENTRIES_PER_PROFILE: 1000,
            ARCHIVE_WARNING_THRESHOLD: 950,
            CLEANUP_BATCH_SIZE: 100
        };

        const AppState = {
            currentProfile: null,
            profiles: [],
            currentTab: 'healthLog',
            healthEntries: [],
            medications: [],
            appointments: [],
            archivedEntriesCount: 0
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadProfiles();
            
            // Check if user needs onboarding
            const hasCompletedOnboarding = localStorage.getItem('embermate_onboarding_completed');
            if (!hasCompletedOnboarding) {
                showOnboarding();
                return;
            }
            
            setupEventListeners();
            initializeSampleData();
            renderCurrentView();
            
            // Set focus to skip link on page load for screen readers
            const skipLink = document.querySelector('.skip-link');
            if (skipLink) skipLink.focus();
        }

        function setupEventListeners() {
            // Profile switcher
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            
            profileBtn?.addEventListener('click', function(e) {
                e.stopPropagation();
                const isOpen = profileDropdown.classList.contains('show');
                profileDropdown.classList.toggle('show');
                profileBtn.setAttribute('aria-expanded', !isOpen);
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!profileDropdown?.contains(e.target) && e.target !== profileBtn) {
                    profileDropdown?.classList.remove('show');
                    profileBtn?.setAttribute('aria-expanded', 'false');
                }
            });

            // Add profile button
            document.getElementById('addProfileBtn')?.addEventListener('click', function() {
                showModal('addProfileModal');
                document.getElementById('profileDropdown')?.classList.remove('show');
            });

            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });

                // Keyboard navigation for tabs
                tab.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const tabName = this.dataset.tab;
                        switchTab(tabName);
                    }
                });
            });

            // Timeline filters
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    filterTimeline(this.dataset.filter);
                });
            });

            // Chart period controls
            document.querySelectorAll('.chart-control-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-control-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateCharts(this.dataset.period);
                });
            });

            // Escape key to close modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.show').forEach(modal => {
                        closeModal(modal.id);
                    });
                }
            });

            // Quick action cards keyboard support
            document.querySelectorAll('.quick-action-card').forEach(card => {
                card.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }

        // ===== PROFILE MANAGEMENT =====
        function loadProfiles() {
            const savedProfiles = localStorage.getItem('embermate_profiles');
            if (savedProfiles) {
                AppState.profiles = JSON.parse(savedProfiles);
            } else {
                // Create default profile
                AppState.profiles = [{
                    id: generateId(),
                    name: 'Demo User',
                    relation: 'self',
                    dateOfBirth: null,
                    conditions: [],
                    avatar: '👤',
                    isActive: true
                }];
                saveProfiles();
            }

            AppState.currentProfile = AppState.profiles.find(p => p.isActive) || AppState.profiles[0];
            renderProfileList();
            updateProfileDisplay();
        }

        function saveProfiles() {
            localStorage.setItem('embermate_profiles', JSON.stringify(AppState.profiles));
        }

        function renderProfileList() {
            const profileList = document.getElementById('profileList');
            if (!profileList) return;

            profileList.innerHTML = AppState.profiles.map(profile => `
                <div class="profile-item ${profile.isActive ? 'active' : ''}" 
                     onclick="switchProfile('${profile.id}')"
                     role="menuitem"
                     tabindex="0">
                    <div class="profile-item-avatar">${profile.avatar}</div>
                    <div class="profile-item-info">
                        <div class="profile-item-name">${profile.name}</div>
                        <div class="profile-item-relation">${capitalizeFirst(profile.relation)}</div>
                    </div>
                    ${profile.isActive ? '<span class="profile-item-badge">Active</span>' : ''}
                </div>
            `).join('');

            // Add keyboard support for profile items
            profileList.querySelectorAll('.profile-item').forEach(item => {
                item.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }

        function updateProfileDisplay() {
            const profile = AppState.currentProfile;
            document.getElementById('currentProfileName').textContent = profile.name;
            document.getElementById('currentProfileAvatar').textContent = profile.avatar;
        }

        function switchProfile(profileId) {
            AppState.profiles.forEach(p => p.isActive = (p.id === profileId));
            AppState.currentProfile = AppState.profiles.find(p => p.id === profileId);
            
            saveProfiles();
            renderProfileList();
            updateProfileDisplay();
            renderCurrentView();
            
            document.getElementById('profileDropdown')?.classList.remove('show');
            document.getElementById('profileBtn')?.setAttribute('aria-expanded', 'false');
            
            showToast('Profile switched', `Now viewing ${AppState.currentProfile.name}'s health data`, 'info');
        }

        function createNewProfile() {
            const name = document.getElementById('newProfileName').value.trim();
            const relation = document.getElementById('newProfileRelation').value;

            if (!name) {
                showToast('Error', 'Please enter a name', 'error');
                return;
            }

            const newProfile = {
                id: generateId(),
                name: name,
                relation: relation,
                dateOfBirth: null,
                conditions: [],
                avatar: name[0].toUpperCase(),
                isActive: false
            };

            AppState.profiles.push(newProfile);
            saveProfiles();
            renderProfileList();
            
            closeModal('addProfileModal');
            showToast('Profile created', `${name}'s profile has been added`, 'success');
            
            // Clear form
            document.getElementById('newProfileName').value = '';
            document.getElementById('newProfileRelation').value = 'self';
        }

        // ===== TAB NAVIGATION =====
        function switchTab(tabName) {
            AppState.currentTab = tabName;

            // Update tab states
            document.querySelectorAll('.nav-tab').forEach(tab => {
                const isActive = tab.dataset.tab === tabName;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive);
                tab.setAttribute('tabindex', isActive ? '0' : '-1');
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-panel`)?.classList.add('active');

            // Special handling for analytics tab
            if (tabName === 'analytics') {
                setTimeout(() => initializeCharts(), 100);
            }
            
            // Update archived entries notice on profile tab
            if (tabName === 'profile') {
                updateArchivedEntriesNotice();
            }
        }

        function updateArchivedEntriesNotice() {
            const notice = document.getElementById('archivedEntriesNotice');
            const countSpan = document.getElementById('archivedCount');
            
            if (notice && countSpan && AppState.archivedEntriesCount > 0) {
                countSpan.textContent = AppState.archivedEntriesCount;
                notice.style.display = 'block';
            } else if (notice) {
                notice.style.display = 'none';
            }
        }

        // ===== MODAL MANAGEMENT =====
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            modal.classList.add('show');
            
            // Trap focus in modal
            const focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];

            // Focus first element
            setTimeout(() => firstFocusable?.focus(), 100);

            // Handle tab key
            modal.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        }
                    } else {
                        if (document.activeElement === lastFocusable) {
                            e.preventDefault();
                            firstFocusable.focus();
                        }
                    }
                }
            });
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal?.classList.remove('show');
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(title, message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;

            const iconMap = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-icon">${iconMap[type]}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;

            container.appendChild(toast);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 200);
            }, 4000);
        }

        // ===== CAREGIVER QUICK ACTIONS (V2.7) =====
        function logAllMedsDone() {
            // This would mark all medications for today as taken
            const profile = AppState.currentProfile;
            
            // Simulate logging all meds
            showToast(
                'Medications logged',
                `All medications marked as taken for ${profile.name} 💊`,
                'success'
            );

            // In real implementation, update medication records
            // with auto-profile tagging
        }

        function showAskForVitalsModal() {
            const modalBody = `
                <div class="form-group">
                    <label class="form-label">Send reminder to</label>
                    <select class="form-select">
                        <option>${AppState.currentProfile.name}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-textarea" placeholder="Time to check your vitals! 🩺">Time to check your vitals! Don't forget to log your blood pressure and blood sugar.</textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="sendVitalsReminder()">Send a gentle reminder</button>
                </div>
            `;

            document.getElementById('quickAddModalTitle').textContent = 'Ask for Vitals';
            document.getElementById('quickAddModalBody').innerHTML = modalBody;
            showModal('quickAddModal');
        }

        function sendVitalsReminder() {
            showToast(
                'Reminder sent',
                'Vitals check reminder sent successfully 📲',
                'success'
            );
            closeModal('quickAddModal');
        }

        function showAddNoteForTomorrowModal() {
            const modalBody = `
                <div class="form-group">
                    <label class="form-label">Reminder for</label>
                    <input type="date" class="form-input" value="${getTomorrowDate()}">
                </div>
                <div class="form-group">
                    <label class="form-label">Note</label>
                    <textarea class="form-textarea" placeholder="Enter reminder note..." autofocus></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveReminderNote()">Set this reminder</button>
                </div>
            `;

            document.getElementById('quickAddModalTitle').textContent = 'Add Note for Tomorrow';
            document.getElementById('quickAddModalBody').innerHTML = modalBody;
            showModal('quickAddModal');
        }

        function saveReminderNote() {
            showToast(
                'Reminder saved',
                `Note scheduled for ${AppState.currentProfile.name} 📝`,
                'success'
            );
            closeModal('quickAddModal');
        }

        // ===== QUICK ADD MODAL =====
        function showQuickAddModal(type) {
            let modalContent = '';

            switch(type) {
                case 'vitals':
                    modalContent = getVitalsForm();
                    break;
                case 'glucose':
                    modalContent = getGlucoseForm();
                    break;
                case 'medication':
                    modalContent = getMedicationForm();
                    break;
                case 'weight':
                    modalContent = getWeightForm();
                    break;
                case 'mood':
                    modalContent = getMoodForm();
                    break;
                default:
                    modalContent = '<p>Select an entry type</p>';
            }

            document.getElementById('quickAddModalTitle').textContent = `Add ${capitalizeFirst(type)}`;
            document.getElementById('quickAddModalBody').innerHTML = modalContent;
            showModal('quickAddModal');
        }

        function getVitalsForm() {
            return `
                <div class="form-group">
                    <label class="form-label">Systolic (top number)</label>
                    <input type="number" class="form-input" id="systolic" placeholder="120" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label">Diastolic (bottom number)</label>
                    <input type="number" class="form-input" id="diastolic" placeholder="80">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (optional)</label>
                    <textarea class="form-textarea" id="vitalsNotes" placeholder="How are you feeling?"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveVitals()">Log this reading</button>
                </div>
            `;
        }

        function getGlucoseForm() {
            return `
                <div class="form-group">
                    <label class="form-label">Blood Sugar (mg/dL)</label>
                    <input type="number" class="form-input" id="glucose" placeholder="96" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label">Timing</label>
                    <select class="form-select" id="glucoseTiming">
                        <option value="fasting">Fasting</option>
                        <option value="before-meal">Before Meal</option>
                        <option value="after-meal">After Meal</option>
                        <option value="bedtime">Bedtime</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (optional)</label>
                    <textarea class="form-textarea" id="glucoseNotes"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveGlucose()">Log this reading</button>
                </div>
            `;
        }

        function getMedicationForm() {
            return `
                <div class="form-group">
                    <label class="form-label">Medication Name</label>
                    <input type="text" class="form-input" id="medName" placeholder="e.g., Lisinopril" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label">Dosage</label>
                    <input type="text" class="form-input" id="medDosage" placeholder="e.g., 10mg">
                </div>
                <div class="form-group">
                    <label class="form-label">Time Taken</label>
                    <input type="time" class="form-input" id="medTime">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveMedication()">Mark as done</button>
                </div>
            `;
        }

        function getWeightForm() {
            return `
                <div class="form-group">
                    <label class="form-label">Weight</label>
                    <div class="flex gap-2">
                        <input type="number" class="form-input" id="weight" placeholder="150" step="0.1" autofocus>
                        <select class="form-select" id="weightUnit" style="width: auto;">
                            <option value="lbs">lbs</option>
                            <option value="kg">kg</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (optional)</label>
                    <textarea class="form-textarea" id="weightNotes"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveWeight()">Log this weight</button>
                </div>
            `;
        }

        function getMoodForm() {
            return `
                <div class="form-group">
                    <label class="form-label">How are you feeling?</label>
                    <div class="health-buddy-mood-selector">
                        <button class="health-buddy-mood-btn" onclick="selectMood('great')" aria-label="Feeling great">😄</button>
                        <button class="health-buddy-mood-btn" onclick="selectMood('good')" aria-label="Feeling good">😊</button>
                        <button class="health-buddy-mood-btn" onclick="selectMood('okay')" aria-label="Feeling okay">😐</button>
                        <button class="health-buddy-mood-btn" onclick="selectMood('tired')" aria-label="Feeling tired">😴</button>
                        <button class="health-buddy-mood-btn" onclick="selectMood('unwell')" aria-label="Not feeling well">😷</button>
                    </div>
                    <input type="hidden" id="selectedMood">
                </div>
                <div class="form-group">
                    <label class="form-label">Any notes? (optional)</label>
                    <textarea class="form-textarea" id="moodNotes" placeholder="What's on your mind?"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('quickAddModal')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveMood()">Log how I'm feeling</button>
                </div>
            `;
        }

        function selectMood(mood) {
            document.querySelectorAll('.health-buddy-mood-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('selectedMood').value = mood;
        }

        // Save functions
        function saveVitals() {
            const systolic = document.getElementById('systolic').value;
            const diastolic = document.getElementById('diastolic').value;
            const notes = document.getElementById('vitalsNotes').value;

            if (!systolic || !diastolic) {
                showToast('Error', 'Please enter both systolic and diastolic values', 'error');
                return;
            }

            // Save to AppState with profile tagging
            const entry = {
                id: generateId(),
                type: 'vitals',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { systolic, diastolic },
                notes
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            closeModal('quickAddModal');
            showToast('Great job!', `Blood pressure ${systolic}/${diastolic} recorded 🩺`, 'success');
            renderCurrentView();
        }

        function saveGlucose() {
            const glucose = document.getElementById('glucose').value;
            const timing = document.getElementById('glucoseTiming').value;
            const notes = document.getElementById('glucoseNotes').value;

            if (!glucose) {
                showToast('Error', 'Please enter blood sugar value', 'error');
                return;
            }

            const entry = {
                id: generateId(),
                type: 'glucose',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { glucose, timing },
                notes
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            closeModal('quickAddModal');
            showToast('Recorded!', `Blood sugar ${glucose} mg/dL logged 🩸`, 'success');
            renderCurrentView();
        }

        function saveMedication() {
            const name = document.getElementById('medName').value;
            const dosage = document.getElementById('medDosage').value;
            const time = document.getElementById('medTime').value;

            if (!name || !dosage) {
                showToast('Error', 'Please enter medication name and dosage', 'error');
                return;
            }

            const entry = {
                id: generateId(),
                type: 'medication',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { name, dosage, time },
                notes: ''
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            closeModal('quickAddModal');
            showToast('Perfect!', `${name} logged successfully 💊`, 'success');
            renderCurrentView();
        }

        function saveWeight() {
            const weight = document.getElementById('weight').value;
            const unit = document.getElementById('weightUnit').value;
            const notes = document.getElementById('weightNotes').value;

            if (!weight) {
                showToast('Error', 'Please enter weight', 'error');
                return;
            }

            const entry = {
                id: generateId(),
                type: 'weight',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { weight, unit },
                notes
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            closeModal('quickAddModal');
            showToast('Noted!', `Weight ${weight} ${unit} recorded ⚖️`, 'success');
            renderCurrentView();
        }

        function saveMood() {
            const mood = document.getElementById('selectedMood').value;
            const notes = document.getElementById('moodNotes').value;

            if (!mood) {
                showToast('Error', 'Please select a mood', 'error');
                return;
            }

            const entry = {
                id: generateId(),
                type: 'mood',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { mood },
                notes
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            closeModal('quickAddModal');
            showToast('Thanks for sharing!', 'Your mood has been logged 😊', 'success');
            renderCurrentView();
        }

        function logMood(mood) {
            const entry = {
                id: generateId(),
                type: 'mood',
                profileId: AppState.currentProfile.id,
                profileName: AppState.currentProfile.name,
                timestamp: new Date().toISOString(),
                data: { mood },
                notes: ''
            };

            AppState.healthEntries.push(entry);
            saveHealthEntries();

            showToast('Thanks!', 'Your mood has been logged', 'success');
        }

        // ===== DATA PERSISTENCE =====
        function saveHealthEntries() {
            // Archive old entries if profile exceeds limit
            archiveOldEntriesIfNeeded();
            localStorage.setItem('embermate_health_entries', JSON.stringify(AppState.healthEntries));
        }

        function loadHealthEntries() {
            const saved = localStorage.getItem('embermate_health_entries');
            if (saved) {
                AppState.healthEntries = JSON.parse(saved);
            }
            
            // Load archived count
            const archivedData = localStorage.getItem('embermate_archived_entries');
            if (archivedData) {
                const archived = JSON.parse(archivedData);
                AppState.archivedEntriesCount = archived.length || 0;
            }
        }

        function archiveOldEntriesIfNeeded() {
            if (!AppState.currentProfile) return;
            
            // Count entries for current profile
            const profileEntries = AppState.healthEntries.filter(
                entry => entry.profileId === AppState.currentProfile.id
            );
            
            const profileCount = profileEntries.length;
            
            // Show warning if approaching limit
            if (profileCount >= APP_CONFIG.ARCHIVE_WARNING_THRESHOLD && 
                profileCount < APP_CONFIG.MAX_ENTRIES_PER_PROFILE) {
                const remaining = APP_CONFIG.MAX_ENTRIES_PER_PROFILE - profileCount;
                showToast(
                    'Storage notice', 
                    `${remaining} entries remaining. Older entries will be archived soon to keep the app fast.`, 
                    'info'
                );
            }
            
            // Archive if limit exceeded
            if (profileCount > APP_CONFIG.MAX_ENTRIES_PER_PROFILE) {
                const entriesToArchive = profileCount - APP_CONFIG.MAX_ENTRIES_PER_PROFILE + APP_CONFIG.CLEANUP_BATCH_SIZE;
                
                // Sort profile entries by date (oldest first)
                const sortedEntries = [...profileEntries].sort((a, b) => 
                    new Date(a.timestamp) - new Date(b.timestamp)
                );
                
                // Take oldest entries to archive
                const oldestEntries = sortedEntries.slice(0, entriesToArchive);
                const oldestIds = new Set(oldestEntries.map(e => e.id));
                
                // Load existing archived entries
                const archivedData = localStorage.getItem('embermate_archived_entries');
                const archived = archivedData ? JSON.parse(archivedData) : [];
                
                // Add entries to archive
                archived.push(...oldestEntries);
                
                // Remove from active entries
                AppState.healthEntries = AppState.healthEntries.filter(
                    entry => !oldestIds.has(entry.id)
                );
                
                // Save archived entries
                localStorage.setItem('embermate_archived_entries', JSON.stringify(archived));
                AppState.archivedEntriesCount = archived.length;
                
                // Notify user
                showToast(
                    'Entries archived', 
                    `${entriesToArchive} older entries were archived to keep the app fast.`, 
                    'success'
                );
            }
        }

        // ===== SAMPLE DATA =====
        function initializeSampleData() {
            loadHealthEntries();
            
            if (AppState.healthEntries.length === 0) {
                // Add some sample data for demo
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                AppState.healthEntries = [
                    {
                        id: generateId(),
                        type: 'vitals',
                        profileId: AppState.currentProfile.id,
                        profileName: AppState.currentProfile.name,
                        timestamp: today.toISOString(),
                        data: { systolic: 120, diastolic: 80 },
                        notes: 'Demo vitals entry'
                    },
                    {
                        id: generateId(),
                        type: 'glucose',
                        profileId: AppState.currentProfile.id,
                        profileName: AppState.currentProfile.name,
                        timestamp: today.toISOString(),
                        data: { glucose: 100, timing: 'routine' },
                        notes: ''
                    },
                    {
                        id: generateId(),
                        type: 'medication',
                        profileId: AppState.currentProfile.id,
                        profileName: AppState.currentProfile.name,
                        timestamp: yesterday.toISOString(),
                        data: { name: 'Medication A', dosage: 'Standard', time: 'Morning' },
                        notes: ''
                    }
                ];
                saveHealthEntries();
            }
        }

        // ===== TIMELINE =====
        function filterTimeline(filter) {
            // Filter timeline entries based on type
            // In real implementation, this would filter the displayed entries
            console.log('Filtering timeline by:', filter);
        }

        function renderCurrentView() {
            // Re-render based on current tab
            // This would update the relevant sections based on current profile and data
            console.log('Rendering view for profile:', AppState.currentProfile.name);
        }

        // ===== CHARTS =====
        function initializeCharts() {
            // Blood Pressure Chart
            const bpCtx = document.getElementById('bpChart');
            if (bpCtx && bpCtx.getContext) {
                new Chart(bpCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [
                            {
                                label: 'Systolic',
                                data: [120, 118, 122, 119, 121, 120, 118],
                                borderColor: '#ff7a52',
                                backgroundColor: 'rgba(255, 122, 82, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Diastolic',
                                data: [80, 78, 82, 79, 81, 80, 78],
                                borderColor: '#4ecdc4',
                                backgroundColor: 'rgba(78, 205, 196, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                labels: { color: '#b0b0b0' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#888888' },
                                grid: { color: '#404040' }
                            },
                            x: {
                                ticks: { color: '#888888' },
                                grid: { color: '#404040' }
                            }
                        }
                    }
                });
            }

            // Blood Sugar Chart
            const bsCtx = document.getElementById('bsChart');
            if (bsCtx && bsCtx.getContext) {
                new Chart(bsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Blood Sugar (mg/dL)',
                            data: [100, 98, 102, 99, 101, 100, 98],
                            borderColor: '#4cc9f0',
                            backgroundColor: 'rgba(76, 201, 240, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                labels: { color: '#b0b0b0' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#888888' },
                                grid: { color: '#404040' },
                                suggestedMin: 70,
                                suggestedMax: 120
                            },
                            x: {
                                ticks: { color: '#888888' },
                                grid: { color: '#404040' }
                            }
                        }
                    }
                });
            }
        }

        function updateCharts(period) {
            // Update charts based on selected period
            console.log('Updating charts for period:', period);
        }

        // ===== DATA MANAGEMENT =====
        function exportData() {
            const data = {
                profiles: AppState.profiles,
                healthEntries: AppState.healthEntries,
                medications: AppState.medications,
                appointments: AppState.appointments,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `embermate-export-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('Export complete', 'Your data has been downloaded', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Validate data structure
                        if (data.profiles && data.healthEntries) {
                            AppState.profiles = data.profiles;
                            AppState.healthEntries = data.healthEntries;
                            AppState.medications = data.medications || [];
                            AppState.appointments = data.appointments || [];
                            
                            saveProfiles();
                            saveHealthEntries();
                            
                            renderProfileList();
                            renderCurrentView();
                            
                            showToast('Import complete', 'Your data has been restored', 'success');
                        } else {
                            showToast('Import failed', 'Invalid data format', 'error');
                        }
                    } catch (error) {
                        showToast('Import failed', 'Could not read file', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function importCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const csvText = event.target.result;
                        const lines = csvText.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            showToast('Import failed', 'CSV file is empty', 'error');
                            return;
                        }

                        // Parse header row
                        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                        
                        // Required columns: date, type, value
                        const dateIdx = headers.findIndex(h => h.includes('date'));
                        const typeIdx = headers.findIndex(h => h.includes('type') || h.includes('category'));
                        const valueIdx = headers.findIndex(h => h.includes('value') || h.includes('reading'));
                        const notesIdx = headers.findIndex(h => h.includes('note'));

                        if (dateIdx === -1 || typeIdx === -1 || valueIdx === -1) {
                            showToast('Import failed', 'CSV must have date, type, and value columns', 'error');
                            return;
                        }

                        let imported = 0;
                        let skipped = 0;

                        // Process data rows
                        for (let i = 1; i < lines.length; i++) {
                            const values = lines[i].split(',').map(v => v.trim());
                            
                            if (values.length < Math.max(dateIdx, typeIdx, valueIdx) + 1) {
                                skipped++;
                                continue;
                            }

                            const date = values[dateIdx];
                            const type = values[typeIdx].toLowerCase();
                            const value = values[valueIdx];
                            const notes = notesIdx >= 0 ? values[notesIdx] : '';

                            // Validate date
                            const dateObj = new Date(date);
                            if (isNaN(dateObj.getTime())) {
                                skipped++;
                                continue;
                            }

                            // Map type to valid entry types
                            let entryType = 'vitals';
                            let vitalType = '';
                            
                            if (type.includes('blood') || type.includes('bp') || type.includes('pressure')) {
                                entryType = 'vitals';
                                vitalType = 'bloodPressure';
                            } else if (type.includes('glucose') || type.includes('sugar') || type.includes('bs')) {
                                entryType = 'vitals';
                                vitalType = 'bloodSugar';
                            } else if (type.includes('weight')) {
                                entryType = 'vitals';
                                vitalType = 'weight';
                            } else if (type.includes('temp')) {
                                entryType = 'vitals';
                                vitalType = 'temperature';
                            } else if (type.includes('o2') || type.includes('oxygen')) {
                                entryType = 'vitals';
                                vitalType = 'oxygen';
                            } else if (type.includes('med') || type.includes('medication')) {
                                entryType = 'medication';
                            } else if (type.includes('symptom')) {
                                entryType = 'symptom';
                            } else if (type.includes('mood')) {
                                entryType = 'mood';
                            } else {
                                // Default to note
                                entryType = 'note';
                            }

                            // Create health entry
                            const entry = {
                                id: generateId(),
                                profileId: AppState.currentProfile.id,
                                profileName: AppState.currentProfile.name,
                                type: entryType,
                                timestamp: dateObj.toISOString(),
                                notes: notes || value
                            };

                            // Add type-specific data
                            if (entryType === 'vitals' && vitalType) {
                                entry.vitalType = vitalType;
                                entry.value = value;
                            } else if (entryType === 'medication') {
                                entry.medicationName = value;
                            } else if (entryType === 'symptom') {
                                entry.symptom = value;
                                entry.severity = 'moderate';
                            } else if (entryType === 'mood') {
                                entry.mood = value;
                            }

                            AppState.healthEntries.push(entry);
                            imported++;
                        }

                        if (imported > 0) {
                            saveHealthEntries();
                            renderCurrentView();
                            showToast('CSV imported', `${imported} entries added${skipped > 0 ? `, ${skipped} skipped` : ''}`, 'success');
                        } else {
                            showToast('Import failed', 'No valid entries found', 'error');
                        }

                    } catch (error) {
                        console.error('CSV import error:', error);
                        showToast('Import failed', 'Could not parse CSV file', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                return;
            }

            localStorage.clear();
            location.reload();
        }

        function saveProfileSettings() {
            const name = document.getElementById('profileNameInput').value;
            const relation = document.getElementById('profileRelationInput').value;
            const dob = document.getElementById('profileDOBInput').value;
            const conditions = document.getElementById('profileConditionsInput').value;

            if (!name) {
                showToast('Error', 'Please enter a name', 'error');
                return;
            }

            AppState.currentProfile.name = name;
            AppState.currentProfile.relation = relation;
            AppState.currentProfile.dateOfBirth = dob;
            AppState.currentProfile.conditions = conditions.split(',').map(c => c.trim()).filter(c => c);
            AppState.currentProfile.avatar = name[0].toUpperCase();

            saveProfiles();
            renderProfileList();
            updateProfileDisplay();

            showToast('Profile updated', 'Your changes have been saved', 'success');
        }

        // ===== ONBOARDING FUNCTIONS =====
        let onboardingRole = null;

        function showOnboarding() {
            const modal = document.getElementById('onboardingModal');
            modal.style.display = 'flex';
            document.getElementById('onboardingStep1').style.display = 'block';
            document.getElementById('onboardingStep2').style.display = 'none';
            document.getElementById('onboardingStep3').style.display = 'none';
        }

        function selectRole(role) {
            onboardingRole = role;
            document.getElementById('onboardingStep1').style.display = 'none';
            document.getElementById('onboardingStep2').style.display = 'block';
            
            // Pre-fill relation based on role
            const relationSelect = document.getElementById('onboardingRelation');
            if (role === 'patient') {
                relationSelect.value = 'self';
            }
            
            // Focus on name input
            setTimeout(() => {
                document.getElementById('onboardingName').focus();
            }, 100);
        }

        function onboardingBack(toStep) {
            if (toStep === 1) {
                document.getElementById('onboardingStep2').style.display = 'none';
                document.getElementById('onboardingStep1').style.display = 'block';
            }
        }

        function onboardingCreateProfile() {
            const name = document.getElementById('onboardingName').value.trim();
            const relation = document.getElementById('onboardingRelation').value;

            if (!name) {
                showToast('Please enter a name', 'We need a name for the profile', 'error');
                return;
            }

            // Create the profile
            const profile = {
                id: generateId(),
                name: name,
                avatar: name[0].toUpperCase(),
                relation: relation,
                dateOfBirth: '',
                conditions: [],
                createdAt: new Date().toISOString()
            };

            AppState.profiles.push(profile);
            AppState.currentProfile = profile;
            saveProfiles();

            // Move to step 3
            document.getElementById('onboardingStep2').style.display = 'none';
            document.getElementById('onboardingStep3').style.display = 'block';
        }

        function finishOnboarding() {
            // Mark onboarding as complete
            localStorage.setItem('embermate_onboarding_completed', 'true');
            
            // Close modal
            document.getElementById('onboardingModal').style.display = 'none';
            
            // Initialize the rest of the app
            setupEventListeners();
            initializeSampleData();
            renderCurrentView();
            
            // Welcome message
            showToast('Welcome to EmberMate! 🎉', 'Let\'s start tracking your health journey', 'success');
        }

        // ===== UTILITY FUNCTIONS =====
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function getTomorrowDate() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true
            });
        }

        // Placeholder functions for appointments and medication management
        function showAddMedicationModal() {
            showToast('Coming soon', 'Medication management feature', 'info');
        }

        function showAddAppointmentModal() {
            showToast('Coming soon', 'Appointment scheduling feature', 'info');
        }

        function logMedication(medName) {
            showToast('Logged', `${medName} marked as taken`, 'success');
        }
    </script>
</body>
</html>
